# ============================================================================
# HYBRID EJBCA DEPLOYMENT - Environment Variables
# ============================================================================
# Author: Adrian Johnson <adrian207@gmail.com>
# Copy this file to .env and fill in your values
# ============================================================================

# ============================================================================
# ENVIRONMENT
# ============================================================================
ENVIRONMENT=dev  # dev or prod
AZURE_REGION=eastus

# ============================================================================
# AZURE CONTAINER REGISTRY
# ============================================================================
ACR_REGISTRY=ejbcapki.azurecr.io
ACR_USERNAME=
ACR_PASSWORD=

# ============================================================================
# AZURE DATABASE FOR POSTGRESQL (Managed Service)
# ============================================================================
# Get these from Terraform output after infrastructure deployment
POSTGRES_HOST=ejbca-pki-dev.postgres.database.azure.com
POSTGRES_DB=ejbca
POSTGRES_USER=ejbcaadmin
POSTGRES_PASSWORD=  # Get from Azure Key Vault

# ============================================================================
# AZURE KEY VAULT (HSM-backed CA Keys)
# ============================================================================
AZURE_KEYVAULT_NAME=ejbca-pki-dev-kv
AZURE_TENANT_ID=
MANAGED_IDENTITY_CLIENT_ID=  # VM's managed identity

# Key Vault secrets and keys
ROOT_CA_KEY_NAME=ejbca-root-ca
ROOT_CA_CERT_NAME=ejbca-root-ca-cert
TLS_CERT_NAME=ejbca-tls

# ============================================================================
# AZURE APPLICATION INSIGHTS (Distributed Tracing)
# ============================================================================
APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=xxxxx;IngestionEndpoint=https://eastus-8.in.applicationinsights.azure.com/

# ============================================================================
# AZURE MONITOR (Managed Prometheus + Grafana)
# ============================================================================
AZURE_MONITOR_PROMETHEUS_ENDPOINT=https://ejbca-pki-dev-prometheus.eastus.prometheus.monitor.azure.com
PROMETHEUS_PUSH_GATEWAY_URL=https://ejbca-pki-dev-prometheus.eastus.prometheus.monitor.azure.com/api/v1/push
AZURE_GRAFANA_ENDPOINT=https://ejbca-pki-dev-grafana.eastus.grafana.azure.com

# ============================================================================
# AZURE LOG ANALYTICS
# ============================================================================
LOG_ANALYTICS_WORKSPACE_ID=
LOG_ANALYTICS_WORKSPACE_KEY=

# ============================================================================
# AZURE STORAGE ACCOUNT
# ============================================================================
AZURE_STORAGE_ACCOUNT=ejbcapkidev
AZURE_STORAGE_KEY=  # Get from Azure Key Vault
AZURE_FILES_MOUNT_PATH=/mnt/azure-files

# ============================================================================
# EJBCA CONFIGURATION
# ============================================================================
EJBCA_HOSTNAME=ejbca
EJBCA_PUBLIC_HOSTNAME=ejbca.yourcompany.com
EJBCA_CLI_PASSWORD=  # Get from Azure Key Vault

# ============================================================================
# JAVA HEAP SETTINGS
# ============================================================================
# Development (Standard_D4s_v3: 4 vCPU, 16GB RAM)
# JAVA_INITIAL_HEAP=2048m
# JAVA_MAX_HEAP=8192m

# Production (Standard_D8s_v3: 8 vCPU, 32GB RAM)
JAVA_INITIAL_HEAP=4096m
JAVA_MAX_HEAP=16384m

# ============================================================================
# RESOURCE LIMITS
# ============================================================================
# Development
EJBCA_CPU_LIMIT=3
EJBCA_MEMORY_LIMIT=12G
EJBCA_CPU_RESERVATION=2
EJBCA_MEMORY_RESERVATION=6G

# Production
# EJBCA_CPU_LIMIT=6
# EJBCA_MEMORY_LIMIT=24G
# EJBCA_CPU_RESERVATION=4
# EJBCA_MEMORY_RESERVATION=12G

# ============================================================================
# LOGGING
# ============================================================================
LOG_LEVEL=INFO

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM UTC

# ============================================================================
# NOTES
# ============================================================================
# 1. Get database password from Key Vault:
#    az keyvault secret show --vault-name ejbca-pki-dev-kv --name postgres-password --query value -o tsv
#
# 2. Get storage account key from Key Vault:
#    az keyvault secret show --vault-name ejbca-pki-dev-kv --name storage-account-key --query value -o tsv
#
# 3. Get EJBCA CLI password from Key Vault:
#    az keyvault secret show --vault-name ejbca-pki-dev-kv --name ejbca-cli-password --query value -o tsv
#
# 4. Get Application Insights connection string:
#    az monitor app-insights component show --app ejbca-pki-dev-appinsights --resource-group ejbca-pki-dev --query connectionString -o tsv
#
# 5. Get managed identity client ID:
#    az vm identity show --resource-group ejbca-pki-dev --name ejbca-pki-dev-vm --query principalId -o tsv

